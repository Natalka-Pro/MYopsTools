# [MLOps](https://github.com/girafe-ai/mlops)

## Инструкция по запуску пакета в чистом окружении:
```bash
git clone https://github.com/Natalka-Pro/MYopsTools.git
cd MYopsTools/
```

```bash
virtualenv -p /usr/bin/python3.11 venv_name
source venv_name/bin/activate
```

```bash
poetry install
pre-commit install
pre-commit run -a
python MYopsTools/train.py
python MYopsTools/infer.py
```

## Описание ML задачи
Классификация рукописных цифр - датасет [torchvision.datasets.MNIST](https://pytorch.org/vision/main/generated/torchvision.datasets.MNIST.html).

60000 изображений для обучения и 10000 изображений для тестирования.

Задача решается очень упрощённой свёрточной нейронной сетью AlexNet.

---
# Первая домашняя работа
**Текст задания:**

Необходимо создать открытый репозиторий, в нём создать пакет на Python, который будет являться валидным с точки зрения пакетирования и решать какую-либо задачу машинного обучения (сейчас не так важно какую, для примера можете взять [классификацию кошек против собак](https://github.com/girafe-ai/ml-course/blob/master/week0_10_cnn/week10_cnn_seminar.ipynb) из нашего курса по МЛ). Выбирайте задачу, которая у вас будет обучаться не более 5 минут!!! Иначе и вы, и мы будем долго ждать.

Под "решать" понимается дву вещи:
1. есть файл train.py, в котором данные загружаются, модель тренируется и сохраняется на диск
2. есть файл infer.py, который считывает с диска модель из предыдущего пункта, загружает валидационный датасет, предсказывает моделью ответы для этих данных, записывает ответы на диск в .csv файл, выводит в stdout (`print`) необходимые метрики на этом датасете.

Как мы будем проверять ДЗ:
1. клонируем репозиторий
2. создаём новый чистый virtualenv
3. poetry install - нужна успешная установка (верная конфигурация)
4. pre-commit install - нужна успешная установка (верная конфигурация)
5. pre-commit run -a - не должно быть проваленных хуков (необходимые хуки это black, isort, flake8)
6. python train.py - ожидаем сохранённую модель
7. python infer.py - ожидаем печать метрик и файл с ответами

Технические подсказки:
1. Не забывайте про if \__name__ == '\__main__':
2. Пишите в вашу дефолтную ветку, мы не будем переключать, проверка скриптованная.

**Дедлайн (жёсткий): суббота, 7 октября, 12.00 по Мск**


---
# Вторая домашняя работа
**Текст задания:**

Следующий этап развития проекта это добавление системы управления данными, в нашем случае это dvc, конфигурации экспериментов на основе hydra, а также логирование на основе mlflow. Для тех, кто делает проекты с нейросетями будет плюсом использование фреймворка для обучения модели (catalyst, lightning, hugging face). Напоследок сконфигурировать простой сервер предсказаний модели используя mlflow models.

1. DVC
Для dvc в качестве бекенда проще и доступнее всего использовать гугл диск (проверьте, что папка доступна по ссылке на чтение всем, иначе мы не сможем проверить), можно использовать и любой другой бекенд, но тут возникает такой же вопрос с доступностью.
Скачивание данных с помощью dvc необходимо встроить в имеющиеся команды train и infer, для этого у dvc есть python api (на крайний случай можно дёрнуть CLI).

2. Hydra
Переведите основные гиперпараметры препроцессинга, обучения и постпроцессинга в yaml конфиги hydra. Сами конфиги лучше всего расположить в папке configs в корне репозитория.

3. Logging
Необходимо добавить логирование ваших основных метрик и функций потерь (всего не менее 3 графиков). Также в эксперимент записывать использованные гиперпараметры и версию кода (git commit id). Считайте, что сервер mlflow уже поднят, его адрес добавьте в поле конфига.

4. Inference
Экспортируйте модель в onnx и добавьте команду run_server (либо в fire, либо отдельным .py файлом), в которой используя mlflow models запустите инференс модели из onnx файла.

Результат работы оформите в виде тега с названием ‘hw2’ в git репозитории.

**Дедлайн (жёсткий): вскр, 3 декабря, 23.59 по Мск**

Репозиторий у вас остаётся прежний, поэтому формы заполнять не нужно, достаточно создать тег в git репозитории. Для тех, кто ещё не отправлял нам адрес репы - это можно сделать [в той же форме](https://docs.google.com/forms/d/e/1FAIpQLSfLlurK3Z3KQNnobvvKD8ObZ5NVdaiwf57jaVVHnHoautivpw/viewform?usp=sf_link)
